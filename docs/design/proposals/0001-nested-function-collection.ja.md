---
title: Nested Function Collection
date: 2025-07-06
status: Approved
---

*English version is available [here](0001-nested-function-collection.md).* 

# 提案: 入れ子関数の収集

## 動機
いくつかのプロジェクトでは整理のために入れ子関数を多用しています。
現在のコレクターは最上位の関数しか記録しないため、
入れ子関数を個別に解析することができません。

## 目標
- マッチ漏れを防ぐため、デフォルトで入れ子関数を収集する
- 上位の関数だけが必要な場合はオプトアウト可能とする

## 非目標
- 正規化された AST の生成方法のリファクタリング
- 異なるモジュールにまたがる入れ子関数の検出

## 解決案
`FuncDeclaration` ノードをステートメント内まで辿るようコレクターを拡張します。
公開 API と CLI に新しい `excludeNested` フラグを追加します。
入れ子関数はデフォルトで収集され、このフラグが設定されている場合は無視されます。

## 代替案
- 既存の AST ヘルパーではなくカスタムビジターでソースを解析する  
  → 単純さのため却下

## 影響とリスク
デフォルトで入れ子関数を収集すると大規模コードベースではメモリ使用量が増える可能性があります。
必要に応じて `--exclude-nested` を使うことで緩和できます。

## 次のステップ
- ドキュメントとユニットテストの更新
